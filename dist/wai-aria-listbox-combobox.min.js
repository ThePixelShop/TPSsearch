var aria=aria||{};aria.ListboxCombobox=function(t,e,i,s,o,a,n,r){this.combobox=t,this.input=e,this.listbox=i,this.searchFn=s,this.shouldAutoSelect=o,this.onShow=a||function(){},this.onHide=n||function(){},this.activeIndex=-1,this.resultsCount=0,this.shown=!1,this.minlength=r||2,this.hasInlineAutocomplete="both"===e.getAttribute("aria-autocomplete"),this.setupEvents()},aria.ListboxCombobox.prototype.setupEvents=function(){document.body.addEventListener("click",this.checkHide.bind(this)),this.input.addEventListener("keyup",this.checkKey.bind(this)),this.input.addEventListener("keydown",this.setActiveItem.bind(this)),this.input.addEventListener("focus",this.checkShow.bind(this)),this.input.addEventListener("blur",this.checkSelection.bind(this)),this.listbox.addEventListener("click",this.clickItem.bind(this))},aria.ListboxCombobox.prototype.checkKey=function(t){var e=t.which||t.keyCode;switch(e){case aria.KeyCode.UP:case aria.KeyCode.DOWN:case aria.KeyCode.ESC:case aria.KeyCode.RETURN:return void t.preventDefault();default:this.updateResults(!1)}if(this.hasInlineAutocomplete)switch(e){case aria.KeyCode.BACKSPACE:return;default:this.autocompleteItem()}},aria.ListboxCombobox.prototype.updateResults=function(t){var e=this.input.value,i=[];if(e&&e.length>0&&(i=this.searchFn(e)),console.log(i),this.hideListbox(),t||e||(i=[]),i&&i.length){for(var s=0;s<i.length;s++){var o=document.createElement("li");o.className="result",o.setAttribute("role","option"),o.setAttribute("id","result-item-"+s),o.innerText=i[s],this.shouldAutoSelect&&0===s&&(o.setAttribute("aria-selected","true"),aria.Utils.addClass(o,"focused"),this.activeIndex=0),this.listbox.appendChild(o)}aria.Utils.removeClass(this.listbox,"hidden"),this.combobox.setAttribute("aria-expanded","true"),this.resultsCount=i.length,this.shown=!0,this.onShow()}},aria.ListboxCombobox.prototype.setActiveItem=function(t){var e=t.which||t.keyCode,i=this.activeIndex;if(e===aria.KeyCode.ESC)return this.hideListbox(),void setTimeout(function(){this.input.value=""}.bind(this),1);if(this.resultsCount<1){if(!this.hasInlineAutocomplete||e!==aria.KeyCode.DOWN&&e!==aria.KeyCode.UP)return;this.updateResults(!0)}var s,o=this.getItemAt(i);switch(e){case aria.KeyCode.UP:i<=0?i=this.resultsCount-1:i--;break;case aria.KeyCode.DOWN:-1===i||i>=this.resultsCount-1?i=0:i++;break;case aria.KeyCode.RETURN:return s=this.getItemAt(i),void this.selectItem(s);case aria.KeyCode.TAB:return this.checkSelection(),void this.hideListbox();default:return}t.preventDefault(),s=this.getItemAt(i),this.activeIndex=i,o&&(aria.Utils.removeClass(o,"focused"),o.setAttribute("aria-selected","false")),s?(this.input.setAttribute("aria-activedescendant","result-item-"+i),aria.Utils.addClass(s,"focused"),s.setAttribute("aria-selected","true"),this.hasInlineAutocomplete&&(this.input.value=s.innerText)):this.input.setAttribute("aria-activedescendant","")},aria.ListboxCombobox.prototype.getItemAt=function(t){return document.getElementById("result-item-"+t)},aria.ListboxCombobox.prototype.clickItem=function(t){t.target&&"LI"==t.target.nodeName&&this.selectItem(t.target)},aria.ListboxCombobox.prototype.selectItem=function(t){t&&(this.input.value=t.innerText,this.hideListbox())},aria.ListboxCombobox.prototype.checkShow=function(t){this.updateResults(!1)},aria.ListboxCombobox.prototype.checkHide=function(t){t.target===this.input||this.combobox.contains(t.target)||this.hideListbox()},aria.ListboxCombobox.prototype.hideListbox=function(){this.shown=!1,this.activeIndex=-1,this.listbox.innerHTML="",aria.Utils.addClass(this.listbox,"hidden"),this.combobox.setAttribute("aria-expanded","false"),this.resultsCount=0,this.input.setAttribute("aria-activedescendant",""),this.onHide()},aria.ListboxCombobox.prototype.checkSelection=function(){if(!(this.activeIndex<0)){var t=this.getItemAt(this.activeIndex);this.selectItem(t)}},aria.ListboxCombobox.prototype.autocompleteItem=function(){var t=this.listbox.querySelector(".focused"),e=this.input.value;if(t&&e){var i=t.innerText;e!==i&&(this.input.value=i,this.input.setSelectionRange(e.length,i.length))}},aria.KeyCode={BACKSPACE:8,TAB:9,RETURN:13,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46},aria.Utils=aria.Utils||{},aria.Utils.matches=function(t,e){return Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(e){for(var i=t.parentNode.querySelectorAll(e),s=i.length;--s>=0&&i.item(s)!==this;);return s>-1}),t.matches(e)},aria.Utils.remove=function(t){return t.remove&&"function"==typeof t.remove?t.remove():!(!t.parentNode||!t.parentNode.removeChild||"function"!=typeof t.parentNode.removeChild)&&t.parentNode.removeChild(t)},aria.Utils.isFocusable=function(t){if(t.tabIndex>0||0===t.tabIndex&&null!==t.getAttribute("tabIndex"))return!0;if(t.disabled)return!1;switch(t.nodeName){case"A":return!!t.href&&"ignore"!=t.rel;case"INPUT":return"hidden"!=t.type&&"file"!=t.type;case"BUTTON":case"SELECT":case"TEXTAREA":return!0;default:return!1}},aria.Utils.getAncestorBySelector=function(t,e){if(!aria.Utils.matches(t,e+" "+t.tagName))return null;for(var i=t,s=null;null===s;)aria.Utils.matches(i.parentNode,e)?s=i.parentNode:i=i.parentNode;return s},aria.Utils.hasClass=function(t,e){return new RegExp("(\\s|^)"+e+"(\\s|$)").test(t.className)},aria.Utils.addClass=function(t,e){aria.Utils.hasClass(t,e)||(t.className+=" "+e)},aria.Utils.removeClass=function(t,e){var i=new RegExp("(\\s|^)"+e+"(\\s|$)");t.className=t.className.replace(i," ").trim()},aria.Utils.bindMethods=function(t){Array.prototype.slice.call(arguments,1).forEach(function(e){t[e]=t[e].bind(t)})};